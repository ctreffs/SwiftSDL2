name: Windows

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:

jobs:
  windows-test-build-release:
    runs-on: windows-latest
    steps:
      # - uses: compnerd/gha-setup-swift@main
      #   with:
      #     branch: swift-5.7-release
      #     tag: 5.7-RELEASE

      # - name: Checkout
      #   uses: actions/checkout@v3.5.2

      - name: Cache vcpkg
        uses: actions/cache@v3.3.1
        with:
          key: windows-x64-vcpkg
          path: $VCPKG_DIRECTORY

      - name: Install dependencies, generate shims & copy libs
        shell: pwsh
        env:
          PKG_CONFIG: C:\vcpkg\installed\x64-windows\tools\pkgconf\pkgconf.exe
          PKG_CONFIG_PATH: C:\vcpkg\installed\x64-windows\tools\pkgconf\
        run: |
          vcpkg install sdl2[core,vulkan] --recurse --triplet x64-windows
          # choco install pkgconfiglite
          # pkgconfiglite --exists sdl2

          vcpkg install --triplet x64-windows pkgconf

          vcpkg integrate install

          pkgconf --version

          status = `$(pkgconf sdl2 --exists)``
          echo "SDL FOUND: $status"
          
          pkgconf sdl2 --print-variables

      # - name: Test & Build Release
      #   env:
      #     PKG_CONFIG_PATH: $PWD/vcpkg/installed/x64-windows/lib/pkgconfig
      #   run: |
      #     swift test
      #     swift build -c release
